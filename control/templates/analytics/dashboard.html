{% extends 'analytics/base_analytics.html' %} {% block content %}

<!-- Quick Access to Today's Analytics -->
<div class="mb-6">
  <a
    href="{% url 'control:daily_analytics' %}"
    class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-ctpink-500 hover:bg-ctpink-400 text-black font-semibold transition-colors">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5a2.25 2.25 0 002.25-2.25m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5a2.25 2.25 0 002.25 2.25v7.5" />
    </svg>
    View Today's Analytics
  </a>
  <a
    href="{% url 'control:colleges_list' %}"
    class="inline-flex items-center gap-2 px-4 py-2 ml-3 rounded-lg bg-white/10 hover:bg-white/20 text-gray-100 font-semibold transition-colors">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 3l9 6-9 6-9-6 9-6zm0 12l9-6v9H3v-9l9 6z" />
    </svg>
    Colleges Overview
  </a>
</div>

<div class="grid grid-cols-1 md:grid-cols-5 gap-4">
  <!-- KPIs -->
  <div class="glass rounded-xl p-5">
    <div class="text-sm text-gray-400">Total Users</div>
    <div class="mt-1 text-3xl font-bold text-ctpink-400">{{ kpis.total_users }}</div>
  </div>
  <div class="glass rounded-xl p-5">
    <div class="text-sm text-gray-400">Total Chats</div>
    <div class="mt-1 text-3xl font-bold text-ctpink-400">{{ kpis.total_chats }}</div>
  </div>
  <div class="glass rounded-xl p-5">
    <div class="text-sm text-gray-400">Total Messages</div>
    <div class="mt-1 text-3xl font-bold text-ctpink-400">{{ kpis.total_messages }}</div>
  </div>
  <div class="glass rounded-xl p-5">
    <div class="text-sm text-gray-400">Active Chats</div>
    <div class="mt-1 text-3xl font-bold text-ctpink-400">{{ kpis.active_chats }}</div>
  </div>
  <div class="glass rounded-xl p-5">
    <div class="text-sm text-gray-400">Colleges</div>
    <div class="mt-1 text-3xl font-bold text-ctpink-400">{{ kpis.total_colleges_with_students }}</div>
  </div>
</div>

<!-- Charts (simple textual trends for now) -->
<div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
  <div class="glass rounded-xl p-5">
    <div class="flex items-center justify-between">
      <h2 class="font-semibold">Chats by Day</h2>
      <a class="text-ctpink-400 text-sm" href="{% url 'control:chats_list' %}">See all</a>
    </div>
    <div class="mt-4 space-y-2 text-sm">
      {% for row in chats_by_day %}
      <div class="flex justify-between text-gray-300">
        <span>{{ row.day }}</span>
        <span class="text-ctpink-400 font-medium">{{ row.c }}</span>
      </div>
      {% empty %}
      <div class="text-gray-500">No data</div>
      {% endfor %}
    </div>
  </div>
  <div class="glass rounded-xl p-5">
    <h2 class="font-semibold">Chats by Month</h2>
    <div class="mt-4 space-y-2 text-sm">
      {% for row in chats_by_month %}
      <div class="flex justify-between text-gray-300">
        <span>{{ row.month|date:'Y-m' }}</span>
        <span class="text-ctpink-400 font-medium">{{ row.c }}</span>
      </div>
      {% empty %}
      <div class="text-gray-500">No data</div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Top Chats & Users -->
<div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
  <div class="glass rounded-xl p-5">
    <div class="flex items-center justify-between">
      <h2 class="font-semibold">Top Chats by Messages</h2>
      <a class="text-ctpink-400 text-sm" href="{% url 'control:chats_list' %}?sort=-msgs">View</a>
    </div>
    <ul class="mt-4 divide-y divide-white/5">
      {% for chat in chat_message_counts %}
      <li class="py-3 flex items-center justify-between">
        <div class="text-sm text-gray-300">
          <a href="{% url 'control:chat_detail' chat.id %}" class="font-medium hover:underline"
            >{{ chat.participant1.display_name }} â†” {{ chat.participant2.display_name }}</a
          >
          <div class="text-xs text-gray-400">{{ chat.college.name|default:"Cross-Org" }}</div>
        </div>
        <div class="text-ctpink-400 font-semibold">{{ chat.msgs }}</div>
      </li>
      {% empty %}
      <li class="py-4 text-gray-500">No chats</li>
      {% endfor %}
    </ul>
  </div>
  <div class="glass rounded-xl p-5">
    <h2 class="font-semibold">Top Users by Messages</h2>
    <ul class="mt-4 divide-y divide-white/5">
      {% for u in top_users %}
      <li class="py-3 flex items-center justify-between">
        <div class="text-sm text-gray-300">
          <a href="{% url 'control:user_chats' u.id %}" class="font-medium hover:underline">{{ u.display_name }}</a>
          <div class="text-xs text-gray-400">{{ u.email }}</div>
        </div>
        <div class="text-ctpink-400 font-semibold">{{ u.msgs }}</div>
      </li>
      {% empty %}
      <li class="py-4 text-gray-500">No users</li>
      {% endfor %}
    </ul>
  </div>
  <div class="glass rounded-xl p-5">
    <div class="flex items-center justify-between">
      <h2 class="font-semibold">Students by College</h2>
      <a class="text-ctpink-400 text-sm" href="{% url 'control:users_list' %}">View All</a>
    </div>
    <ul class="mt-4 divide-y divide-white/5">
      {% for college in college_registrations %}
      <li class="py-3 flex items-center justify-between">
        <div class="text-sm text-gray-300">
          <a href="{% url 'control:college_detail' college.college__id %}" class="font-medium hover:underline"
            >{{ college.college__name }}</a
          >
          <div class="text-xs text-gray-400">Registered Students</div>
        </div>
        <div class="text-ctpink-400 font-semibold">{{ college.student_count }}</div>
      </li>
      {% empty %}
      <li class="py-4 text-gray-500">No college registrations</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}
