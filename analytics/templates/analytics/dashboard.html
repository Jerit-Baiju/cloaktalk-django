{% extends 'analytics/base_analytics.html' %} {% block content %}
<div class="grid grid-cols-1 md:grid-cols-4 gap-4">
  <!-- KPIs -->
  <div class="glass rounded-xl p-5">
    <div class="text-sm text-gray-400">Total Users</div>
    <div class="mt-1 text-3xl font-bold text-ctpink-400">{{ kpis.total_users }}</div>
  </div>
  <div class="glass rounded-xl p-5">
    <div class="text-sm text-gray-400">Total Chats</div>
    <div class="mt-1 text-3xl font-bold text-ctpink-400">{{ kpis.total_chats }}</div>
  </div>
  <div class="glass rounded-xl p-5">
    <div class="text-sm text-gray-400">Total Messages</div>
    <div class="mt-1 text-3xl font-bold text-ctpink-400">{{ kpis.total_messages }}</div>
  </div>
  <div class="glass rounded-xl p-5">
    <div class="text-sm text-gray-400">Active Chats</div>
    <div class="mt-1 text-3xl font-bold text-ctpink-400">{{ kpis.active_chats }}</div>
  </div>
</div>

<!-- Charts (simple textual trends for now) -->
<div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
  <div class="glass rounded-xl p-5">
    <div class="flex items-center justify-between">
      <h2 class="font-semibold">Chats by Day</h2>
      <a class="text-ctpink-400 text-sm" href="{% url 'analytics:chats_list' %}">See all</a>
    </div>
    <div class="mt-4 space-y-2 text-sm">
      {% for row in chats_by_day %}
      <div class="flex justify-between text-gray-300">
        <span>{{ row.day }}</span>
        <span class="text-ctpink-400 font-medium">{{ row.c }}</span>
      </div>
      {% empty %}
      <div class="text-gray-500">No data</div>
      {% endfor %}
    </div>
  </div>
  <div class="glass rounded-xl p-5">
    <h2 class="font-semibold">Chats by Month</h2>
    <div class="mt-4 space-y-2 text-sm">
      {% for row in chats_by_month %}
      <div class="flex justify-between text-gray-300">
        <span>{{ row.month|date:'Y-m' }}</span>
        <span class="text-ctpink-400 font-medium">{{ row.c }}</span>
      </div>
      {% empty %}
      <div class="text-gray-500">No data</div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Top Chats & Users -->
<div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
  <div class="glass rounded-xl p-5">
    <div class="flex items-center justify-between">
      <h2 class="font-semibold">Top Chats by Messages</h2>
      <a class="text-ctpink-400 text-sm" href="{% url 'analytics:chats_list' %}?sort=-msgs">View</a>
    </div>
    <ul class="mt-4 divide-y divide-white/5">
      {% for chat in chat_message_counts %}
      <li class="py-3 flex items-center justify-between">
        <div class="text-sm text-gray-300">
          <a href="{% url 'analytics:chat_detail' chat.id %}" class="font-medium hover:underline"
            >{{ chat.participant1.display_name }} â†” {{ chat.participant2.display_name }}</a
          >
          <div class="text-xs text-gray-400">{{ chat.college.name }}</div>
        </div>
        <div class="text-ctpink-400 font-semibold">{{ chat.msgs }}</div>
      </li>
      {% empty %}
      <li class="py-4 text-gray-500">No chats</li>
      {% endfor %}
    </ul>
  </div>
  <div class="glass rounded-xl p-5">
    <h2 class="font-semibold">Top Users by Messages</h2>
    <ul class="mt-4 divide-y divide-white/5">
      {% for u in top_users %}
      <li class="py-3 flex items-center justify-between">
        <div class="text-sm text-gray-300">
          <a href="{% url 'analytics:user_chats' u.id %}" class="font-medium hover:underline">{{ u.display_name }}</a>
          <div class="text-xs text-gray-400">{{ u.email }}</div>
        </div>
        <div class="text-ctpink-400 font-semibold">{{ u.msgs }}</div>
      </li>
      {% empty %}
      <li class="py-4 text-gray-500">No users</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}
